<htmlform>

<!-- =========================
     NDOVU STUDY ENROLLMENT
     ========================= -->

<fieldset>
  <legend>Ndovu Study Enrollment</legend>

  <table style="width:100%; border-collapse: collapse;">
    <tr>
      <td style="padding:6px; width:45%;"><b>Study ID</b><br/>
        <small>8 characters e.g. BHCE0001</small>
      </td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_STUDY_ID" id="study_id" required="true" />
        <br/>
        <span style="color:#666; font-size:12px;">Format: 4 letters + 4 digits (example: BHCE0001)</span>
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>Date of enrollment</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_ENROLLMENT_DATE" required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>Any documented Drug Resistant Mutations from prior Drug Resistance Testing?</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_DRM_YN" answerConceptIds="CONCEPT_UUID_YES,CONCEPT_UUID_NO" required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>Date of first documented HIV positive test result</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_FIRST_HIV_POS_DATE" required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>DTG regimen</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_DTG_REGIMEN"
             answerConceptIds="CONCEPT_UUID_TDF_3TC_DTG,
                              CONCEPT_UUID_TAF_3TC_DTG,
                              CONCEPT_UUID_ABC_3TC_DTG,
                              CONCEPT_UUID_AZT_3TC_DTG,
                              CONCEPT_UUID_TDF_FTC_DTG,
                              CONCEPT_UUID_TAF_FTC_DTG,
                              CONCEPT_UUID_ABC_FTC_DTG,
                              CONCEPT_UUID_AZT_FTC_DTG,
                              CONCEPT_UUID_DTG_3TC"
             required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>What is the current dosage of DTG that you are taking?</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_DTG_DOSAGE"
             answerConceptIds="CONCEPT_UUID_DTG_10MG,CONCEPT_UUID_DTG_50MG"
             required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>Date started DTG</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_DTG_START_DATE" required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>How often do you take DTG?</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_DTG_FREQUENCY"
             answerConceptIds="CONCEPT_UUID_ONCE_DAILY,CONCEPT_UUID_TWICE_DAILY"
             required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>Have you experienced any side effects while taking DTG?</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_DTG_SIDE_EFFECTS_YN"
             answerConceptIds="CONCEPT_UUID_YES,CONCEPT_UUID_NO"
             required="true" />
      </td>
    </tr>

    <tr>
      <td style="padding:6px;"><b>Have you ever had issues with drug interactions while on DTG?</b></td>
      <td style="padding:6px;">
        <obs conceptId="CONCEPT_UUID_DTG_INTERACTIONS_YN"
             answerConceptIds="CONCEPT_UUID_YES,CONCEPT_UUID_NO"
             required="true" />
      </td>
    </tr>
  </table>
</fieldset>


<!-- =========================
     VALIDATION (Study ID)
     ========================= -->

<script type="text/javascript">
  (function() {
    function normalize(v){ return (v || "").trim().toUpperCase(); }

    // Expected pattern: 4 letters + 4 digits (BHCE0001)
    var pattern = /^[A-Z]{4}[0-9]{4}$/;

    // HTML Form Entry renders inputs; we hook by id we set above.
    var el = document.getElementById("study_id");

    function validate() {
      if (!el) return true;
      var v = normalize(el.value);
      el.value = v;

      // allow empty only if not required; but we set required=true
      var ok = pattern.test(v);
      if (!ok) {
        alert("Study ID must be 8 characters: 4 letters followed by 4 digits (e.g., BHCE0001).");
        el.focus();
      }
      return ok;
    }

    // Hook into HFE submit if available
    var forms = document.getElementsByTagName("form");
    if (forms && forms.length > 0) {
      forms[0].addEventListener("submit", function(e) {
        if (!validate()) {
          e.preventDefault();
          return false;
        }
      });
    }
  })();
</script>

</htmlform>
